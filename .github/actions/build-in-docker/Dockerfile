FROM ghcr.io/cross-rs/x86_64-unknown-linux-gnu:main-centos
RUN curl https://sh.rustup.rs -sSf  | sh -s -- -y --default-toolchain 1.64 -t aarch64-unknown-linux-gnu -t x86_64-pc-windows-gnu
RUN rpm -i http://springdale.princeton.edu/data/springdale/7/x86_64/os/Computational/glibc-aarch64-linux-gnu-devel-2.24-2.sdl7.2.noarch.rpm http://springdale.princeton.edu/data/springdale/7/x86_64/os/Computational/glibc-aarch64-linux-gnu-2.24-2.sdl7.2.noarch.rpm http://springdale.princeton.edu/data/springdale/7/x86_64/os/Computational/binutils-aarch64-linux-gnu-2.26-6.sdl7.x86_64.rpm http://springdale.princeton.edu/data/springdale/7/x86_64/os/Computational/gcc-aarch64-linux-gnu-4.8.1-5.2.sdl7.1.x86_64.rpm http://springdale.princeton.edu/data/springdale/7/x86_64/os/Computational/cross-binutils-common-2.26-6.sdl7.noarch.rpm http://springdale.princeton.edu/data/springdale/7/x86_64/os/Computational/cross-gcc-common-4.8.1-5.2.sdl7.1.noarch.rpm
RUN cd /usr/aarch64-linux-gnu/ && ln -s lib lib64 && curl http://mirror.centos.org/altarch/7/os/aarch64/Packages/libgcc-4.8.5-44.el7.aarch64.rpm -o - | rpm2cpio | cpio --no-absolute-filenames -iv '*libgcc_s.so.1'
RUN rpm -i https://dl.fedoraproject.org/pub/archive/epel/7.2019-05-29/x86_64/Packages/m/mingw-binutils-generic-2.25-1.el7.x86_64.rpm https://dl.fedoraproject.org/pub/archive/epel/7.2019-05-29/x86_64/Packages/m/mingw64-binutils-2.25-1.el7.x86_64.rpm https://dl.fedoraproject.org/pub/archive/epel/7.2019-05-29/x86_64/Packages/m/mingw64-filesystem-101-1.el7.noarch.rpm https://dl.fedoraproject.org/pub/archive/epel/7.2019-05-29/x86_64/Packages/m/mingw-filesystem-base-101-1.el7.noarch.rpm
RUN rpm -i https://dl.fedoraproject.org/pub/archive/epel/7.2019-05-29/x86_64/Packages/m/mingw64-cpp-4.9.3-1.el7.x86_64.rpm https://dl.fedoraproject.org/pub/archive/epel/7.2019-05-29/x86_64/Packages/m/mingw64-crt-4.0.4-3.el7.noarch.rpm https://dl.fedoraproject.org/pub/archive/epel/7.2019-05-29/x86_64/Packages/m/mingw64-headers-4.0.4-5.el7.noarch.rpm https://dl.fedoraproject.org/pub/archive/epel/7.2019-05-29/x86_64/Packages/m/mingw64-winpthreads-4.0.4-1.el7.noarch.rpm https://dl.fedoraproject.org/pub/archive/epel/7.2019-05-29/x86_64/Packages/m/mingw64-winpthreads-static-4.0.4-1.el7.noarch.rpm
RUN rpm -i https://dl.fedoraproject.org/pub/archive/epel/7.2019-05-29/x86_64/Packages/m/mingw64-gcc-4.9.3-1.el7.x86_64.rpm

ENTRYPOINT ["/github/workspace/.github/actions/build-in-docker/build-in-docker.sh"]
